name: Deploy Ethereum Testnet

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy Ethereum Testnet Node
        run: |
          echo "üê≥ Starting Ethereum node in dev mode..."
          docker run -d \
            --name eth-node \
            -p 8545:8545 \
            -p 8546:8546 \
            ethereum/client-go:latest \
            --dev \
            --dev.period 1 \
            --http \
            --http.addr "0.0.0.0" \
            --http.port 8545 \
            --http.api "eth,net,web3,personal,admin,miner,debug,txpool" \
            --http.corsdomain "*" \
            --http.vhosts "*" \
            --ws \
            --ws.addr "0.0.0.0" \
            --ws.port 8546 \
            --ws.api "eth,net,web3,personal,admin,miner,debug,txpool" \
            --ws.origins "*" \
            --verbosity 3
          
          echo "‚è≥ Waiting for node to start..."
          sleep 15

      - name: Test RPC Connection
        run: |
          echo "üîó Testing RPC connection..."
          curl -X POST http://localhost:8545 \
            -H "Content-Type: application/json" \
            -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
          
          echo ""
          echo "‚úÖ Ethereum testnet node is running!"

      - name: Run your deployment script
        run: |
          # Add your deployment commands here
          # node deploy.js
          echo "Add your deployment steps here"
          sleep 60